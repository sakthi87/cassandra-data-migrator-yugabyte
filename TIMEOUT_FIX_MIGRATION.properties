# =============================================================================
# TIMEOUT FIX MIGRATION CONFIGURATION
# =============================================================================
# This configuration is optimized to handle connection timeout issues
# by reducing parallelism and increasing timeouts

# =============================================================================
# CASSANDRA SOURCE CONFIGURATION
# =============================================================================
spark.cdm.connect.origin.host=vcausc11udev057.azr.bank-dns.com
spark.cdm.connect.origin.port=9042
spark.cdm.connect.origin.username=cassandraappiduat
spark.cdm.connect.origin.password=Uat@123456
spark.cdm.connect.origin.localDC=datacenter1
spark.cdm.connect.origin.consistencyLevel=LOCAL_ONE

# =============================================================================
# YUGABYTEDB TARGET CONFIGURATION
# =============================================================================
spark.cdm.connect.target.yugabyte.host=vcausc11udev057.azr.bank-dns.com
spark.cdm.connect.target.yugabyte.port=5433
spark.cdm.connect.target.yugabyte.database=cdmybtest
spark.cdm.connect.target.yugabyte.username=yugabyte
spark.cdm.connect.target.yugabyte.password=password

# =============================================================================
# SCHEMA CONFIGURATION
# =============================================================================
spark.cdm.schema.origin.keyspaceTable=customer_datastore.customer_mtrc_by_lpid
spark.cdm.schema.target.keyspaceTable=customer_datastore.customer_mtrc_by_lpid

# =============================================================================
# REDUCED PARALLELISM (TO AVOID TIMEOUTS)
# =============================================================================
# Reduce parallelism to avoid overwhelming YugabyteDB
spark.executor.cores=2
spark.executor.instances=2
spark.executor.memory=4G
spark.driver.memory=4G

# Reduce partitions to minimize concurrent connections
spark.cdm.perfops.numParts=100

# =============================================================================
# CONNECTION TIMEOUT SETTINGS
# =============================================================================
# Increase timeouts to handle slow network connections
spark.cdm.connect.origin.timeout=120000
spark.cdm.connect.target.yugabyte.timeout=120000

# =============================================================================
# RATE LIMITING (CONSERVATIVE)
# =============================================================================
# Reduce rate limits to avoid overwhelming the target database
spark.cdm.rate.origin.readsPerSecond=1000
spark.cdm.rate.target.writesPerSecond=1000

# =============================================================================
# BATCH PROCESSING (CONSERVATIVE)
# =============================================================================
# Use smaller batch sizes to reduce connection load
spark.cdm.perfops.batchSize=1000
spark.cdm.batch.size=1000
spark.cdm.fetch.size=1000

# =============================================================================
# ERROR HANDLING AND LOGGING
# =============================================================================
spark.cdm.log.directory=migration_logs
spark.cdm.log.level=INFO

# =============================================================================
# SPARK CONFIGURATION (CONSERVATIVE)
# =============================================================================
spark.sql.adaptive.enabled=true
spark.sql.adaptive.coalescePartitions.enabled=true
spark.sql.adaptive.skewJoin.enabled=true

# Reduce network overhead
spark.serializer=org.apache.spark.serializer.KryoSerializer
spark.sql.adaptive.advisoryPartitionSizeInBytes=64MB

# =============================================================================
# YUGABYTEDB SPECIFIC SETTINGS
# =============================================================================
# Connection pool settings
spark.cdm.connect.target.yugabyte.maxConnections=5
spark.cdm.connect.target.yugabyte.connectionTimeout=60000
spark.cdm.connect.target.yugabyte.socketTimeout=120000

# =============================================================================
# NETWORK OPTIMIZATION
# =============================================================================
# Reduce network overhead
spark.network.timeout=600s
spark.sql.broadcastTimeout=600s
spark.sql.execution.arrow.pyspark.enabled=false

# =============================================================================
# MEMORY MANAGEMENT
# =============================================================================
# Conservative memory settings
spark.executor.memoryFraction=0.6
spark.storage.memoryFraction=0.3
spark.sql.execution.arrow.maxRecordsPerBatch=1000
