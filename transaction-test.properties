# =============================================================================
# CDM Migration Properties - Transaction Table Test
# =============================================================================
# This file is configured for testing migration from Cassandra to YugabyteDB
# Source: transaction_datastore.dda_pstd_fincl_txn_cnsmr_by_accntnbr
# Target: transaction_datastore.dda_pstd_fincl_txn_cnsmr_by_accntnbr
# =============================================================================

# =============================================================================
# ORIGIN (CASSANDRA) CONNECTION
# =============================================================================
spark.cdm.connect.origin.host=localhost
spark.cdm.connect.origin.port=9043
spark.cdm.connect.origin.username=cassandra
spark.cdm.connect.origin.password=cassandra

# =============================================================================
# TARGET (YUGABYTEDB YSQL) CONNECTION
# =============================================================================
spark.cdm.connect.target.yugabyte.host=localhost
spark.cdm.connect.target.yugabyte.port=5433
spark.cdm.connect.target.yugabyte.database=transaction_datastore
spark.cdm.connect.target.yugabyte.username=yugabyte
spark.cdm.connect.target.yugabyte.password=yugabyte

# =============================================================================
# SCHEMA CONFIGURATION
# =============================================================================
spark.cdm.schema.origin.keyspaceTable=transaction_datastore.dda_pstd_fincl_txn_cnsmr_by_accntnbr
spark.cdm.schema.target.keyspaceTable=transaction_datastore.dda_pstd_fincl_txn_cnsmr_by_accntnbr

# =============================================================================
# HIGH-PERFORMANCE SETTINGS (Phase 1+2 Optimizations)
# =============================================================================
# Phase 1: PreparedStatement reuse
# Phase 2: JDBC batching with rewriteBatchedInserts
spark.cdm.connect.target.yugabyte.batchSize=25
spark.cdm.connect.target.yugabyte.rewriteBatchedInserts=true
# Note: loadBalance disabled for local Docker (requires topologyKeys for multi-region)
spark.cdm.connect.target.yugabyte.loadBalance=false
spark.cdm.connect.target.yugabyte.prepareThreshold=5
spark.cdm.connect.target.yugabyte.socketTimeout=60000
spark.cdm.connect.target.yugabyte.tcpKeepAlive=true

# Connection Pool Settings
# Reduced to avoid "too many clients" error with multiple partitions
# Each partition creates its own pool, so: 20 partitions × 5 connections = 100 max connections
spark.cdm.connect.target.yugabyte.pool.maxSize=5
spark.cdm.connect.target.yugabyte.pool.minSize=2

# =============================================================================
# PERFORMANCE SETTINGS
# =============================================================================
# Optimized for 100k records - targeting 20k IOPS/throughput
# Balance partitions vs connection pool limits
# With 20 partitions × 5 connections = 100 connections max (safe for YugabyteDB)
spark.cdm.perfops.numParts=20
# Batch size matches YugabyteDB batch size for optimal performance
spark.cdm.perfops.batchSize=25
# Higher rate limits for 100k records (20k IOPS target)
spark.cdm.perfops.ratelimit.origin=20000
spark.cdm.perfops.ratelimit.target=20000
# Larger fetch size for better throughput
spark.cdm.perfops.fetchSizeInRows=1000

# Consistency Levels
spark.cdm.perfops.consistency.read=LOCAL_ONE
spark.cdm.perfops.consistency.write=LOCAL_QUORUM

# =============================================================================
# LOGGING
# =============================================================================
spark.cdm.log.directory=migration_logs
spark.cdm.log.level=INFO

# =============================================================================
# TRACKING (Optional - for resumable migrations)
# =============================================================================
spark.cdm.trackRun=false

