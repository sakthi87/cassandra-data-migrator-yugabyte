# =============================================================================
# SERVER-LIMITED OPTIMIZATION CONFIGURATION
# =============================================================================
# This configuration maximizes performance without server-side changes
# Focus: Client-side optimizations and connection management

# =============================================================================
# CONNECTION POOLING & LIMITS
# =============================================================================
spark.cdm.connect.target.yugabyte.maxConnections=1000
spark.cdm.connect.target.yugabyte.connectionTimeout=300000
spark.cdm.connect.target.yugabyte.socketTimeout=600000
spark.cdm.connect.target.yugabyte.loginTimeout=300

# Connection-level optimizations
spark.cdm.connect.target.yugabyte.tcpKeepAlive=true
spark.cdm.connect.target.yugabyte.tcpNoDelay=true
spark.cdm.connect.target.yugabyte.autoCommit=false
spark.cdm.connect.target.yugabyte.prepareThreshold=0

# =============================================================================
# MAXIMUM SPARK PARALLELISM
# =============================================================================
# Disable adaptive features that reduce parallelism
spark.sql.adaptive.enabled=false
spark.sql.adaptive.coalescePartitions.enabled=false
spark.sql.adaptive.skewJoin.enabled=false
spark.sql.adaptive.localShuffleReader.enabled=false

# Maximum parallelism
spark.executor.cores=30
spark.executor.instances=20
spark.executor.memory=30G
spark.driver.memory=30G

# High partition count
spark.cdm.perfops.numParts=2000
spark.sql.shuffle.partitions=2000

# =============================================================================
# AGGRESSIVE BATCH PROCESSING
# =============================================================================
# Large batch sizes for maximum efficiency
spark.cdm.perfops.batchSize=10000
spark.cdm.batch.size=10000
spark.cdm.fetch.size=100000

# =============================================================================
# MAXIMUM RATE LIMITING
# =============================================================================
spark.cdm.rate.origin.readsPerSecond=200000
spark.cdm.rate.target.writesPerSecond=200000
spark.cdm.perfops.readRateLimit=200000
spark.cdm.perfops.writeRateLimit=200000

# =============================================================================
# NETWORK OPTIMIZATION
# =============================================================================
spark.cdm.network.bufferSize=262144
spark.cdm.network.sendBufferSize=262144
spark.cdm.network.receiveBufferSize=262144

# Network timeouts
spark.network.timeout=1200s
spark.sql.broadcastTimeout=900s

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================
spark.cdm.compression.enabled=true
spark.cdm.partition.size=20000000
spark.cdm.thread.count=200

# =============================================================================
# YUGABYTE CONNECTION OPTIMIZATION
# =============================================================================
spark.cdm.connect.target.yugabyte.pooling.enabled=true
spark.cdm.connect.target.yugabyte.pooling.maxSize=1000
spark.cdm.connect.target.yugabyte.pooling.minSize=200
spark.cdm.connect.target.yugabyte.preparedStatementCacheSize=5000

# =============================================================================
# SERIALIZATION OPTIMIZATION
# =============================================================================
spark.serializer=org.apache.spark.serializer.KryoSerializer
spark.kryo.unsafe=true
spark.kryo.registrationRequired=false
spark.kryo.maxBufferSize=64m

# =============================================================================
# ERROR HANDLING
# =============================================================================
spark.cdm.retry.maxAttempts=2
spark.cdm.retry.delayMs=500
spark.cdm.continueOnError=true

# =============================================================================
# LOGGING
# =============================================================================
spark.cdm.log.directory=migration_logs
spark.driver.extraJavaOptions=-Dlog4j.configuration=file:log4j2-quiet.properties
spark.executor.extraJavaOptions=-Dlog4j.configuration=file:log4j2-quiet.properties
